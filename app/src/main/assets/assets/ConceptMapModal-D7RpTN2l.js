import{j as s,r as m,C as R}from"./index-Qv1PFdT_.js";const S=({data:a})=>{const{nodes:o,edges:d}=a,[l,g]=m.useState({x:0,y:0,k:1}),[h,k]=m.useState(null),w=m.useRef(null),v=m.useRef(!1),b=m.useRef({x:0,y:0}),{positionedNodes:$,viewBox:E}=m.useMemo(()=>{if(!o||o.length===0)return{positionedNodes:new Map,viewBox:"0 0 800 600"};const e=new Map;if(o[0].position&&typeof o[0].position.x=="number"){let t=1/0,n=-1/0,r=1/0,c=-1/0;o.forEach(f=>{const x=f.position.x,p=f.position.y;e.set(f.id,{...f,x,y:p}),x<t&&(t=x),x>n&&(n=x),p<r&&(r=p),p>c&&(c=p)});const i=100,u=n-t,j=c-r,y=`${t-i} ${r-i} ${u+i*2} ${j+i*2}`;return{positionedNodes:e,viewBox:y}}else{const i=Math.min(800,600)/2-100,u=2*Math.PI/o.length;return o.forEach((j,y)=>{const f=400+i*Math.cos(y*u-Math.PI/2),x=300+i*Math.sin(y*u-Math.PI/2);e.set(j.id,{...j,x:f,y:x})}),{positionedNodes:e,viewBox:"0 0 800 600"}}},[o]),{connectedNodes:N,connectedEdges:M}=m.useMemo(()=>{if(!h)return{connectedNodes:null,connectedEdges:null};const e=new Set([h]),t=new Set;return d.forEach((n,r)=>{n.source===h&&(e.add(n.target),t.add(`edge-${r}`)),n.target===h&&(e.add(n.source),t.add(`edge-${r}`))}),{connectedNodes:e,connectedEdges:t}},[h,d]),X=e=>{var t;v.current=!0,b.current={x:e.clientX,y:e.clientY},(t=w.current)==null||t.classList.add("grabbing")},I=e=>{if(!v.current)return;const t=e.clientX-b.current.x,n=e.clientY-b.current.y;g(r=>({...r,x:r.x+t,y:r.y+n})),b.current={x:e.clientX,y:e.clientY}},Y=()=>{var e;v.current=!1,(e=w.current)==null||e.classList.remove("grabbing")},L=e=>{e.preventDefault();const t=1.1,n=e.deltaY<0?l.k*t:l.k/t,r=Math.max(.2,Math.min(n,5));g(c=>({...c,k:r}))},D=e=>$.get(e);return s.jsxs("svg",{ref:w,viewBox:E,className:"concept-map-svg",onMouseDown:X,onMouseMove:I,onMouseUp:Y,onMouseLeave:Y,onWheel:L,children:[s.jsx("defs",{children:s.jsx("marker",{id:"arrowhead",viewBox:"-5 -5 10 10",refX:"0",refY:"0",markerWidth:"6",markerHeight:"6",orient:"auto",children:s.jsx("path",{d:"M 0,0 m -5,-5 L 5,0 L -5,5 Z",className:"arrow-head-path"})})}),s.jsxs("g",{transform:`translate(${l.x}, ${l.y}) scale(${l.k})`,children:[d.map((e,t)=>{const n=D(e.source),r=D(e.target);if(!n||!r)return null;const c=(n.x+r.x)/2,i=(n.y+r.y)/2,u=h&&!(M!=null&&M.has(`edge-${t}`));return s.jsxs("g",{className:`edge ${u?"dimmed":""}`,children:[s.jsx("line",{x1:n.x,y1:n.y,x2:r.x,y2:r.y,markerEnd:"url(#arrowhead)"}),s.jsx("text",{x:c,y:i,textAnchor:"middle",dy:"-6",className:"edge-label",children:e.label})]},`edge-${t}`)}),Array.from($.values()).map(e=>{const t=h&&!(N!=null&&N.has(e.id));return s.jsxs("g",{transform:`translate(${e.x}, ${e.y})`,className:`node-group ${t?"dimmed":""}`,onMouseEnter:()=>k(e.id),onMouseLeave:()=>k(null),children:[s.jsx("circle",{r:"60",className:"node-circle"}),s.jsx("foreignObject",{x:"-55",y:"-55",width:"110",height:"110",children:s.jsx("div",{className:"node-label-wrapper",children:s.jsx("p",{className:"node-label",children:e.label})})})]},e.id)})]})]})},C=({data:a})=>s.jsxs("div",{className:"concept-map-matrix-wrapper",children:[s.jsx("h3",{className:"matrix-title",children:a.title}),s.jsx("div",{className:"matrix-table-container",children:s.jsxs("table",{className:"matrix-table",children:[s.jsx("thead",{children:s.jsx("tr",{children:a.headers.map((o,d)=>s.jsx("th",{children:o},d))})}),s.jsx("tbody",{children:a.rows.map((o,d)=>s.jsx("tr",{children:o.map((l,g)=>s.jsx("td",{children:l},g))},d))})]})})]}),B=({data:a})=>s.jsx("div",{className:"w-full h-full bg-light-bg dark:bg-dark-bg rounded-lg overflow-hidden border border-light-border dark:border-dark-border",children:a.type==="matrix"?s.jsx(C,{data:a}):s.jsx(S,{data:a})}),W=({data:a,onClose:o})=>s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-start pt-8 p-4",children:s.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface rounded-lg shadow-custom-lg-light dark:shadow-custom-lg-dark w-full max-w-4xl h-[85vh] flex flex-col border border-light-border dark:border-dark-border animate-scale-in",children:[s.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-light-border dark:border-dark-border flex-shrink-0",children:[s.jsx("h2",{className:"text-xl font-bold font-display",children:"Concept Map"}),s.jsx("button",{onClick:o,className:"p-2 rounded-full hover:bg-black/10 dark:hover:bg-white/10",children:s.jsx(R,{className:"h-6 w-6"})})]}),s.jsx("div",{className:"p-4 flex-grow overflow-hidden",children:s.jsx(B,{data:a})})]})});export{W as default};
