import{r as u,j as e,a as q,N as H,I as P,D,R as L,P as O,b as V,E as Y,Q as J,M as W,C as X}from"./index-Qv1PFdT_.js";const Z=s=>new Promise((n,r)=>{const t=new FileReader;t.readAsDataURL(s),t.onload=()=>{const b=t.result.split(",")[1];if(!b){r(new Error("Could not extract Base64 string from file."));return}n(b)},t.onerror=l=>r(l)}),ee=s=>new Promise((n,r)=>{const t=new FileReader;t.readAsText(s),t.onload=()=>{n(t.result)},t.onerror=l=>r(l)}),c=({onClick:s,disabled:n,label:r,children:t,className:l=""})=>e.jsxs("div",{className:"relative has-tooltip",children:[e.jsx("button",{onClick:s,disabled:n,"aria-label":r,className:`p-2 rounded-full bg-light-bg dark:bg-dark-bg hover:bg-light-border dark:hover:bg-dark-border disabled:opacity-50 disabled:cursor-not-allowed transition-all hover:scale-110 active:scale-95 ${l}`,children:t}),e.jsx("div",{className:"tooltip absolute bottom-full mb-2 w-max bg-gray-800 text-white text-xs rounded py-1 px-2 opacity-0 visibility-hidden transition-all duration-300",children:r})]}),ae=({attachment:s,onRemove:n})=>e.jsxs("div",{className:"flex items-center gap-2 bg-light-border dark:bg-dark-border rounded-full px-3 py-1 text-sm animate-fade-in-up",children:[s.type==="image"?e.jsx(P,{className:"w-4 h-4"}):e.jsx(D,{className:"w-4 h-4"}),e.jsx("span",{className:"truncate max-w-xs",children:s.name}),e.jsx("button",{onClick:n,className:"p-0.5 rounded-full hover:bg-black/10 dark:hover:bg-white/10",children:e.jsx(X,{className:"w-3 h-3"})})]}),te=({sessionState:s,settings:n,onSend:r,onNewSession:t,onContinueAgentTurn:l,onAutoContinueToggle:b,onGenerateQuiz:F,onGenerateConceptMap:U,isGeneratingConceptMap:f,turns:N,onExport:S,onError:T})=>{const[g,y]=u.useState(""),[p,w]=u.useState([]),h=u.useRef(null),v=u.useRef(null),C=u.useRef(null),{sessionMode:I,interactionMode:j,autoContinueAgent:k}=n,o=s==="paused_user_input",_=s==="running_auto",x=s==="finished";u.useEffect(()=>{h.current&&(h.current.style.height="auto",h.current.style.height=`${h.current.scrollHeight}px`)},[g]),u.useEffect(()=>{var a;o&&((a=h.current)==null||a.focus())},[o]);const A=()=>{(g.trim()||p.length>0)&&o&&(r(g,p),y(""),w([]))},$=a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),A())},z=()=>{window.confirm("Are you sure you want to start a new chat? Your current session will be saved.")&&t()},R=async(a,d)=>{if(a)try{const m=await Promise.all(Array.from(a).map(async i=>{const G=d==="image"?await Z(i):await ee(i);return{name:i.name,type:d,mimeType:i.type,data:G}}));w(i=>[...i,...m])}catch(m){console.error("Error processing files:",m),T(`Failed to upload file. Please try again. Error: ${m instanceof Error?m.message:"Unknown error"}`)}},M=a=>R(a.target.files,"image"),B=a=>R(a.target.files,"text"),K=a=>w(d=>d.filter((m,i)=>i!==a)),Q=()=>_?"AI is responding, please wait...":x?"Session finished.":o?j==="direct"?"Send a message or upload a file...":I==="challenge"?"Provide your explanation...":"Ask a follow-up question or press Continue...":"",E=j==="agent"&&I==="tutor";return e.jsxs("div",{className:"bg-light-surface dark:bg-dark-surface rounded-xl p-3 md:p-4 shadow-custom-lg-light dark:shadow-custom-lg-dark border border-light-border dark:border-dark-border",children:[e.jsx("div",{className:"flex items-start gap-2",children:e.jsxs("div",{className:"flex-grow",children:[p.length>0&&e.jsx("div",{className:"mb-2 p-2 bg-light-bg dark:bg-dark-bg rounded-lg flex flex-wrap gap-2",children:p.map((a,d)=>e.jsx(ae,{attachment:a,onRemove:()=>K(d)},`${a.name}-${d}`))}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:h,value:g,onChange:a=>y(a.target.value),onKeyDown:$,placeholder:Q(),disabled:!o,className:"w-full pl-4 pr-12 py-3 border-none rounded-lg resize-none max-h-48 bg-light-bg dark:bg-dark-bg focus:ring-2 focus:ring-light-primary dark:focus:ring-dark-primary focus:outline-none transition disabled:opacity-60 min-h-[52px]",rows:1}),e.jsx("button",{onClick:A,disabled:!o||!g.trim()&&p.length===0,className:"absolute right-3 top-1/2 -translate-y-1/2 p-2 rounded-full bg-light-primary text-white hover:bg-opacity-90 disabled:bg-opacity-50 disabled:cursor-not-allowed transition-all active:scale-95 hover:scale-105","aria-label":"Send message",children:e.jsx(q,{className:"w-5 h-5"})})]})]})}),e.jsx("input",{type:"file",ref:v,onChange:M,accept:"image/*",multiple:!0,className:"hidden"}),e.jsx("input",{type:"file",ref:C,onChange:B,accept:".txt,.md",multiple:!0,className:"hidden"}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-3 justify-center items-center",children:[s!=="idle"&&e.jsx(c,{onClick:z,label:"New Chat",children:e.jsx(H,{className:"w-5 h-5"})}),e.jsx(c,{onClick:()=>{var a;return(a=v.current)==null?void 0:a.click()},disabled:!o,label:"Upload Image",children:e.jsx(P,{className:"w-5 h-5"})}),e.jsx(c,{onClick:()=>{var a;return(a=C.current)==null?void 0:a.click()},disabled:!o,label:"Upload Document",children:e.jsx(D,{className:"w-5 h-5"})}),E&&s==="paused_user_input"&&!k&&e.jsx(c,{onClick:l,label:"Continue Agent (One Turn)",children:e.jsx(L,{className:"w-5 h-5"})}),E&&!x&&s!=="idle"&&e.jsx(c,{onClick:b,label:k?"Stop Auto-Generation":"Start Auto-Generation",children:k?e.jsx(O,{className:"w-5 h-5 text-red-500"}):e.jsx(V,{className:"w-5 h-5 text-green-500"})}),e.jsx(c,{onClick:S,disabled:N.length===0,label:"Export Conversation",children:e.jsx(Y,{className:"w-5 h-5"})}),j==="agent"&&!x&&s!=="idle"&&e.jsx(c,{onClick:F,label:"Finish & Generate Quiz",children:e.jsx(J,{className:"w-5 h-5"})}),!x&&s!=="idle"&&e.jsx(c,{onClick:U,disabled:N.length<2||f,label:f?"Generating...":"Visualize Concepts",className:f?"animate-pulse":"",children:e.jsx(W,{className:"w-5 h-5"})}),x&&e.jsx("span",{className:"px-3 py-1 text-sm bg-light-accent text-white rounded-full font-semibold animate-fade-in-up",children:"Session Finished"})]})]})};export{te as default};
